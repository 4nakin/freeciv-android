#!/bin/bash
#  -Iclient/gui-stub client/gui-stub/*.c
PYTHON=python2.7 # python2.7_d
GCC_PARAMS="-g -Iclient -Iclient/include -Iclient/agents -Icommon -Icommon/aicore -Iutility -I/usr/include/$PYTHON -I. -Iserver -Iserver/generator -Iserver/scripting -Iserver/advisors -Iai -Ilua -Itolua -DHAVE_CONFIG_H"
EXCLUDE_FILES="client/audio_sdl.c lua/luac.c"

output() {
    echo "$1" >> Makefile.tmp
}
echo > Makefile.tmp

ev=""
if [ -e callauto.c ]; then
    rm callauto.c
fi

for name in callauto.c client/*.c *.c client/agents/*.c \
    common/*.c common/aicore/*.c server/*.c server/generator/*.c server/scripting/*.c \
    server/advisors/*.c ai/*.c utility/*.c lua/*.c tolua/*.c; do

    objfile=objectfiles/$(basename $name .c).o
    ev="$ev $objfile"
    output "$objfile: $name"
    output "	gcc $GCC_PARAMS $additional -c -o $objfile $name"
done

echo "all: app" > client.mk
echo "objectfiles_gen: $ev
" >> client.mk
echo "app: objectfiles_gen
	gcc -lz -lm -l$PYTHON objectfiles/*.o -o app" >> client.mk
echo "_graphics.so: _graphicsmodule.h _graphicsmodule.c
	gcc -I/usr/include/python2.7 -l$PYTHON _graphicsmodule.c -shared -o _graphics.so" >> client.mk
echo "libapp.so: objectfiles_gen
	gcc -shared -o libapp.so -lm -lz -l$PYTHON objectfiles/*.o" >> client.mk
echo "callauto.c: ../callglue
	python ../gencallglue.py" >> client.mk
echo "clean:
	rm objectfiles/* libapp.so app callauto.c" >> client.mk
cat Makefile.tmp >> client.mk
mv client.mk Makefile
rm Makefile.tmp
